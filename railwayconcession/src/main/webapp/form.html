<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fill Railway Concession Form</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(180deg, #121040, #1C1A59);
            color: white;
            padding: 150px;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
        }

        form {
            max-width: 800px;
            font-size: 1em;
            margin-left: 270px;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 70px;
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
        }

        input {
            width: 300px;
            padding: 8px;
            border: none;
            border-radius: 5px;
            background-color: #1C1A59;
            color: white;
            font-size: 0.9em;
        }

        input::placeholder {
            color: #cfcfff;
        }

        button {
            width: 20%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            background-color: #645FC6;
            color: white;
            font-size: 1em;
            cursor: pointer;
            margin-left: 300px;
            margin-top: 50px;

        }

        button:hover {
            background-color: #4d47a8;
        }


        header {
            background-color: var(--secondary-bg);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: -70px;
            /* Initially hidden */
            left: 0;
            width: 100%;
            transition: top 0.3s ease;
            /* Smooth transition for showing and hiding */
            z-index: 1000;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        input::-webkit-calendar-picker-indicator {
            display: none !important;
        }
    </style>
</head>

<body>
    <header>
        <h1 style="font-size: 1.5rem;" id="heading"></h1><br>
        <h6 id="userData" style="margin-right: 20px;"></h6>
    </header>
    <div id="form">
        <form method="POST" action="/railwayconcession/display" id="RCform">
            <input type="hidden" name="action1" id="act">
            <div class="form-row">
                <div>
                    <label for="cls">Boagie Class</label>
                    <input type="text" id="class" name="class" list="classes" required>
                </div>
                <div>
                    <label for="dur">Season Duration</label>
                    <input type="text" id="duration" list="seasons" name="duration" required>
                </div>
                <datalist id="seasons">
                    <option value="Monthly">
                    <option value="Quarterly">
                    <option value="Half Yearly">
                    <option value="Yearly">
                </datalist>
                <datalist id="classes">
                    <option value="First">
                    <option value="Second">
                </datalist>
            </div>

            <div class="form-row">
                <div>
                    <label for="dob">Departure</label>
                    <input type="text" id="departure" list="stations" name="departure" required class="input-list">
                </div>
                <div>
                    <label for="destination">Destination</label>
                    <input type="text" id="dest" list="stations" name="destination" required class="input-list">
                </div>
                <datalist id="stations">
                    <!-- Western Line -->
                    <option value="Churchgate">
                    <option value="Marine Lines">
                    <option value="Charni Road">
                    <option value="Grant Road">
                    <option value="Mumbai Central">
                    <option value="Mahalaxmi">
                    <option value="Lower Parel">
                    <option value="Prabhadevi">
                    <option value="Dadar (Western)">
                    <option value="Matunga Road">
                    <option value="Mahim">
                    <option value="Bandra">
                    <option value="Khar Road">
                    <option value="Santacruz">
                    <option value="Vile Parle">
                    <option value="Andheri">
                    <option value="Jogeshwari">
                    <option value="Goregaon">
                    <option value="Malad">
                    <option value="Kandivali">
                    <option value="Borivali">
                    <option value="Dahisar">
                    <option value="Mira Road">
                    <option value="Bhayandar">
                    <option value="Naigaon">
                    <option value="Vasai Road">
                    <option value="Nalasopara">
                    <option value="Virar">
                    <option value="Vaitarna">
                    <option value="Saphale">
                    <option value="Kelva Road">
                    <option value="Palghar">
                    <option value="Umroli">
                    <option value="Boisar">
                    <option value="Vangaon">
                    <option value="Dahanu Road">

                        <!-- Central Line -->
                    <option value="Masjid">
                    <option value="Sandhurst Road">
                    <option value="Byculla">
                    <option value="Chinchpokli">
                    <option value="Parel">
                    <option value="Dadar (Central)">
                    <option value="Matunga">
                    <option value="Sion">
                    <option value="Kurla">
                    <option value="Vidyavihar">
                    <option value="Ghatkopar">
                    <option value="Vikhroli">
                    <option value="Kanjurmarg">
                    <option value="Bhandup">
                    <option value="Nahur">
                    <option value="Mulund">
                    <option value="Thane">
                    <option value="Kalwa">
                    <option value="Mumbra">
                    <option value="Diva Junction">
                    <option value="Kopar">
                    <option value="Dombivli">
                    <option value="Thakurli">
                    <option value="Kalyan">
                    <option value="Shahad">
                    <option value="Ambivli">
                    <option value="Titwala">
                    <option value="Khadavli">
                    <option value="Vasind">
                    <option value="Asangaon">
                    <option value="Atgaon">
                    <option value="Khardi">
                    <option value="Kasara">

                        <!-- Harbour Line -->
                    <option value="CSMT">
                    <option value="Masjid">
                    <option value="Sandhurst Road">
                    <option value="Dockyard Road">
                    <option value="Reay Road">
                    <option value="Cotton Green">
                    <option value="Sewri">
                    <option value="Wadala Road">
                    <option value="GTB Nagar">
                    <option value="Chunabhatti">
                    <option value="Kurla">
                    <option value="Tilaknagar">
                    <option value="Chembur">
                    <option value="Govandi">
                    <option value="Mankhurd">
                    <option value="Vashi">
                    <option value="Sanpada">
                    <option value="Juinagar">
                    <option value="Nerul">
                    <option value="Seawoods-Darave">
                    <option value="Belapur CBD">
                    <option value="Kharghar">
                    <option value="Mansarovar">
                    <option value="Khandeshwar">
                    <option value="Panvel">

                        <!-- Trans-Harbour Line -->
                    <option value="Thane">
                    <option value="Airoli">
                    <option value="Rabale">
                    <option value="Ghansoli">
                    <option value="Kopar Khairane">
                    <option value="Turbhe">
                    <option value="Sanpada">
                    <option value="Vashi">
                    <option value="Belapur CBD">
                    <option value="Panvel">
                </datalist>
            </div>

            <button type="submit" id="send">Submit</button>
        </form>

        <form action="" id="current_page">
            <input type="hidden" name="action1" value="fillform">
        </form>
    </div>

    <div style="display: none;" id="div">
        <label for="" id="concession_id"></label>
    </div><br>

    <button id="ok_btn" style="display: none;" onclick="window.location.href='page2.html'">OK</button>
    <button id="ok_btn_edit" onclick="window.location.href='page2.html'" style="display: none;">OK</button>

    <script>

        window.onload = function () {

            const form = document.getElementById('current_page');
            const formData = new URLSearchParams(new FormData(form));

            fetch('/railwayconcession/display', {
                method: 'POST',
                body: formData.toString(),
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                }
            })
                .then(response => response.json())
                .then(data => {
                    // Handle JSON data
                    if (data.error) {
                        console.error(data.error); // Handle error if no session or user data
                    } else {
                        // Use the data here
                        console.log('Username:', data.username);
                        console.log('Name:', data.name);
                        console.log('ID:', data.id);
                        console.log("formtype : ", data.formtype);
                        const userData = document.getElementById("userData");
                        const cls = document.getElementById("class");
                        const dur = document.getElementById("duration");
                        const dept = document.getElementById("departure");
                        const dest = document.getElementById("dest");
                        let ftp = document.getElementById("act");
                        let heading = document.getElementById("heading");
                        userData.innerHTML = 'Username : ' + data.username + '<br>Student Name : ' + data.name + '<br>Student ID : ' + data.id;

                        if (data.formtype === 'edit') {
                            heading.innerHTML = "Edit Railway Concession Form";
                            cls.value = data.class;
                            dur.value = data.duration;
                            dept.value = data.dept;
                            dest.value = data.dest;
                            act.value = "Concession_form_edit";
                        }
                        else if (data.formtype === 'fill') {
                            heading.innerHTML = "Fill Railway Concession Form";
                            act.value = "Concession_form_fill";
                            cls.placeholder = "Enter Boagie Class";
                            dur.placeholder = "Enter Season Duration";
                            dept.placeholder = "Enter Departure Station";
                            dest.placeholder = "Enter Destination Station";
                            cls.required = true;
                            dur.required = true;
                            dept.required = true;
                            dest.required = true;
                        }
                    }
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });
        }

        const btn = document.getElementById("send");
        const ok = document.getElementById("ok_btn");
        const ok_edit = document.getElementById("ok_btn_edit");

        btn.addEventListener('click', (event) => {

            event.preventDefault();

            const form = document.getElementById('RCform');
            const formData = new URLSearchParams(new FormData(form));

            fetch('/railwayconcession/display', {
                method: 'POST',
                body: formData.toString(),
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
            })
                .then((response) => {
                    // Check if the form submission is successful
                    if (!response.ok) {
                        throw new Error('Error submitting form: ' + response.statusText);
                    }
                    return response.json(); // Read the response as json
                })
                .then((serverMessage) => {

                    let form = document.getElementById("form");
                    let id = document.getElementById("concession_id");
                    let div = document.getElementById("div");

                    if (serverMessage.Concession_id === "Error") {
                        form.style.display = "none";
                        div.style.display = "block"
                        id.innerHTML = serverMessage;
                        ok_edit.style.display = "block";
                    }
                    else if (serverMessage.update === 'successful') {
                        form.style.display = "none";
                        div.style.display = "block"
                        id.innerHTML = "Form Updated Successfully";
                        ok_edit.style.display = "block";
                    }
                    else if (serverMessage.update === 'unsuccessful') {
                        form.style.display = "none";
                        div.style.display = "block"
                        id.innerHTML = "Some Unexpected Error Occured!"
                        ok_edit.style.display = "block";

                    }
                    else if (serverMessage.Concession_id !== null) {
                        console.log('Server Response:', serverMessage);
                        form.style.display = "none";
                        div.style.display = "block";
                        id.innerHTML = "Your Concession ID is " + serverMessage.Concession_id;
                        ok.style.display = "block";
                    }

                })
        })

        const header = document.querySelector('header');
        let timer;
        let lastScrollY = 0;

        // Ensure header is fully visible on page load
        header.style.top = '0px';

        window.addEventListener('scroll', () => {
            clearTimeout(timer);

            const currentScrollY = window.scrollY;

            if (currentScrollY < lastScrollY) {
                // User is scrolling up
                header.style.top = '0px';  // Show header
            } else {
                // User is scrolling down
                header.style.top = '-70px';  // Hide header
            }

            lastScrollY = currentScrollY;

            // Hide the header after a delay when scrolling up slowly
            timer = setTimeout(() => {
                if (currentScrollY > 0) header.style.top = '-70px'; // Hide after scrolling up
            }, 800); // Adjust the timeout delay as needed
        });



    </script>
</body>

</html>